<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Billing System</title>
<style>
  body { font-family: Arial; margin:20px; background:#f4f4f9;}
  h1 { text-align:center; color:#333;}
  .container { display:flex; gap:30px;}
  .items, .bill { flex:1; background:white; padding:15px; border-radius:10px; box-shadow:0px 2px 6px rgba(0,0,0,0.2);}
  .items h2, .bill h2 { margin-bottom:10px; border-bottom:2px solid #ddd; padding-bottom:5px;}
  .item { display:flex; justify-content:space-between; align-items:center; padding:5px 0;}
  .bill table { width:100%; border-collapse:collapse; margin-top:10px;}
  .bill table th, .bill table td { border:1px solid #ccc; padding:8px; text-align:center;}
  .bill input[type="number"] { width:60px;}
  .qty-buttons { display:flex; gap:5px; justify-content:center; align-items:center;}
  .qty-buttons button { padding:2px 8px; cursor:pointer;}
  .total { text-align:right; margin-top:15px; font-size:18px; font-weight:bold;}
  .download-btn { margin-top:10px; padding:10px 15px; background:#333; color:white; border:none; border-radius:5px; cursor:pointer;}
  .download-btn:hover { background:#555;}
  .status-container, .operator-container { margin-top:10px; }
</style>
</head>
<body>
<h1>Billing Website</h1>
<div class="container">
  <div class="items">
    <h2>Available Products</h2>
    <div class="item"><label><input type="checkbox" data-name="Apple" data-price="50"> Apple</label><span>₹50</span></div>
    <div class="item"><label><input type="checkbox" data-name="Banana" data-price="20"> Banana</label><span>₹20</span></div>
    <div class="item"><label><input type="checkbox" data-name="Milk" data-price="40"> Milk</label><span>₹40</span></div>
    <div class="item"><label><input type="checkbox" data-name="Bread" data-price="30"> Bread</label><span>₹30</span></div>
    <div class="item"><label><input type="checkbox" data-name="Eggs" data-price="60"> Eggs (dozen)</label><span>₹60</span></div>
  </div>

  <div class="bill" id="billDiv">
    <h2>Bill</h2>
    <div class="operator-container">
      <label>Operator:
        <select id="billOperator">
          <option value="Abdullah Aftab">Abdullah Aftab</option>
          <option value="Aftab Alam">Aftab Alam</option>
        </select>
      </label>
    </div>
    <div class="status-container">
      <label>Status: 
        <select id="billStatus">
          <option value="Paid">Paid</option>
          <option value="Pending">Pending</option>
        </select>
      </label>
    </div>
    <table id="billTable">
      <thead>
        <tr><th>Item</th><th>Rate</th><th>Qty</th><th>Amount</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="total">Total: ₹<span id="totalAmount">0</span></div>
    <button class="download-btn" id="downloadBtn">Download Bill</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const checkboxes = document.querySelectorAll('.items input[type="checkbox"]');
  const billTableBody = document.querySelector('#billTable tbody');
  const totalAmountEl = document.getElementById('totalAmount');
  const downloadBtn = document.getElementById('downloadBtn');
  const billDiv = document.getElementById('billDiv');
  const billStatus = document.getElementById('billStatus');
  const billOperator = document.getElementById('billOperator');

  let billItems = {};

  function updateBill() {
    let total = 0;
    billTableBody.innerHTML = '';
    for (let name in billItems) {
      let item = billItems[name];
      let row = document.createElement('tr');
      row.innerHTML = `
        <td>${name}</td>
        <td><input type="number" min="0" value="${item.price}" class="price"></td>
        <td class="qty-cell">
          <div class="qty-buttons">
            <button class="minus">-</button>
            <span class="qty">${item.qty}</span>
            <button class="plus">+</button>
          </div>
        </td>
        <td class="amount">₹${item.price*item.qty}</td>
      `;
      billTableBody.appendChild(row);

      // Price change
      row.querySelector('.price').addEventListener('input', e => {
        billItems[name].price = parseInt(e.target.value) || 0;
        updateBill();
      });

      // Quantity buttons
      row.querySelector('.plus').addEventListener('click', () => { billItems[name].qty++; updateBill(); });
      row.querySelector('.minus').addEventListener('click', () => { if(billItems[name].qty>0) billItems[name].qty--; updateBill(); });

      total += item.price * item.qty;
    }
    totalAmountEl.textContent = total;
  }

  checkboxes.forEach(cb => {
    cb.addEventListener('change', () => {
      const name = cb.dataset.name;
      const price = parseInt(cb.dataset.price);
      if(cb.checked) {
        if(!billItems[name]) billItems[name] = {price: price, qty:0};
      } else {
        delete billItems[name];
      }
      updateBill();
    });
  });

  function formatTime12(date) {
    let hours = date.getHours();
    let minutes = date.getMinutes();
    let ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // 0 -> 12
    let strHours = hours < 10 ? '0'+hours : hours;
    let strMinutes = minutes < 10 ? '0'+minutes : minutes;
    return `${strHours}:${strMinutes} ${ampm}`;
  }

  downloadBtn.addEventListener('click', () => {
    const now = new Date();
    const dateStr = now.toLocaleDateString();
    const timeStr = formatTime12(now);

    // Add operator, date/time, and status temporarily
    let infoDiv = document.createElement('div');
    infoDiv.style.textAlign = 'right';
    infoDiv.style.marginTop = '10px';
    infoDiv.id = 'billInfo';
    infoDiv.innerHTML = `Operator: ${billOperator.value} | Date: ${dateStr} | Time: ${timeStr} | Status: ${billStatus.value}`;
    billDiv.appendChild(infoDiv);

    html2canvas(billDiv, {scale:2}).then(canvas => {
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = 'bill.png';
      link.click();
      infoDiv.remove(); // remove temporary info
    });
  });
});
</script>
</body>
</html>
